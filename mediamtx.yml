# MediaMTX Configuration for low-latency HLS & WebRTC ingest.
# Uses runOnReady/runOnNotReady hooks for stream state management.

logLevel: info

rtspAddress: ":8554"
rtspEncryption: "no"
rtspsAddress: ":8322"

rtmpAddress: ":1935"
rtmpEncryption: "no"
rtmpsAddress: ":1936"

hls: false # We serve HLS via NGINX, not MediaMTX's built-in
webrtc: true
webrtcAddress: ":8889"
webrtcICEServers: [stun:stun.l.google.com:19302]
srt: false

api: true
apiAddress: ":9997"

# "all_others" is the MediaMTX v1+ wildcard â€” matches every stream path
# that is not explicitly listed above. This is what allows OBS to push
# rtmp://host:1935/live/test  or  rtmp://host:1935/mystream  etc.
paths:
  all_others:
    # Fire when a publisher's stream is live and ready for readers.
    # on_publish.sh: notifies the API webhook, then exec's FFmpeg ABR.
    # MediaMTX kills this process tree when the publisher disconnects.
    runOnReady: "/on_publish.sh"
    runOnReadyRestart: true

    # Fire when the stream ends (publisher disconnects).
    runOnNotReady: "/on_unpublish.sh"
